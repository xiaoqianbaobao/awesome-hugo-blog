<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:if="${article}" th:text="${article.title} + ' - Qian\'s Blog'">文章详情 - Qian's Blog</title>
    <title th:if="${article == null}">文章详情 - Qian's Blog</title>
    <link href="/css/blog-style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <header class="blog-header">
        <div class="header-content">
            <h1 class="blog-title">Qian's Blog</h1>
            <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="搜索...">
            </div>
        </div>
    </header>

    <nav class="blog-navbar">
        <div class="nav-content">
            <ul class="nav-links">
                <li><a href="/" class="nav-link">🏠主页</a></li>
                <li><a href="/articles" class="nav-link active">📚文章</a></li>
                <li><a href="/timeline" class="nav-link">⏱时间轴</a></li>
                <li><a href="/tags" class="nav-link">🔖标签</a></li>
                <li><a href="/about" class="nav-link">🙋🏻♂️关于</a></li>
                <li><a href="/links" class="nav-link">🤝友链</a></li>
            </ul>
        </div>
    </nav>

    <div class="blog-content">
        <div class="blog-container fade-in" th:if="${article != null}">
            <h1 th:text="${article.title}">文章标题</h1>
            
            <div class="article-meta">
                <i class="bi bi-calendar me-1"></i>
                <span th:text="${#temporals.format(article.createdAt, 'yyyy-MM-dd HH:mm')}">发布时间</span>
                <span class="mx-2">|</span>
                <i class="bi bi-folder me-1"></i>
                <span th:if="${article.category}" th:text="${article.category.name}">分类</span>
                <span th:if="${article.category == null}">未分类</span>
                <span th:if="${article.tags}" class="mx-2">|</span>
                <i class="bi bi-tags me-1" th:if="${article.tags}"></i>
                <span th:if="${article.tags}" th:each="tag : ${#strings.arraySplit(article.tags, ',')}" class="blog-tag" th:text="${tag.trim()}">标签</span>
            </div>
            
            <div class="blog-readable" th:utext="${#strings.replace(#strings.replace(#strings.replace(article.content, '&lt;', '<'), '&gt;', '>'), '&amp;', '&')}">
                文章内容
            </div>
            
            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee;">
                <a href="/articles" class="blog-btn blog-btn-secondary">
                    <i class="bi bi-arrow-left"></i> 返回列表
                </a>
            </div>
        </div>
        
        <div class="blog-container fade-in" th:if="${article == null}">
            <h1>文章未找到</h1>
            <p>抱歉，您请求的文章不存在或已被删除。</p>
            <a href="/articles" class="blog-btn">返回文章列表</a>
        </div>
        
        <!-- 评论区域 -->
        <div class="blog-container fade-in" th:if="${article != null}">
            <h3>💬 评论</h3>
            
            <!-- 评论表单 -->
            <div class="comment-form">
                <form id="commentForm" th:action="@{/article/{id}/comment(id=${article.id})}" method="post">
                    <div class="mb-3">
                        <label class="form-label">昵称（可选）</label>
                        <input type="text" class="blog-form-control" name="nickname" placeholder="请输入您的昵称">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">评论内容</label>
                        <textarea class="blog-form-control" name="content" rows="4" placeholder="请输入您的评论内容" required></textarea>
                    </div>
                    <button type="submit" class="blog-btn">提交评论</button>
                </form>
            </div>
            
            <!-- 评论列表 -->
            <div class="comments-list" style="margin-top: 2rem;">
                <h4>已有 <span th:text="${#lists.size(comments)}">0</span> 条评论</h4>
                
                <div class="comment-item" th:each="comment, iterStat : ${comments}" style="padding: 1rem 0; border-bottom: 1px solid #eee;">
                    <div class="comment-header" style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <div class="comment-author" style="font-weight: 600;">
                            <span th:text="${comment.nickname != null and !comment.nickname.isEmpty() ? comment.nickname : '匿名用户'}">匿名用户</span>
                            <span style="color: #777; font-size: 0.9rem; margin-left: 0.5rem;">#<span th:text="${iterStat.index + 1}">1</span></span>
                        </div>
                        <div class="comment-date" style="color: #777; font-size: 0.9rem;" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">
                            2025-10-17 12:00
                        </div>
                    </div>
                    <div class="comment-content" style="margin-bottom: 1rem;" th:text="${comment.content}">
                        评论内容
                    </div>
                    
                    <!-- 回复表单 -->
                    <div class="reply-form" style="margin-top: 1rem; padding: 1rem; background-color: #f8f9fa; border-radius: 5px;">
                        <form th:action="@{/article/{id}/comment/{commentId}/reply(id=${article.id}, commentId=${comment.id})}" method="post">
                            <div class="mb-2">
                                <label class="form-label">回复 <span th:text="${comment.nickname != null and !comment.nickname.isEmpty() ? comment.nickname : '匿名用户'}"></span></label>
                                <input type="text" class="blog-form-control" name="nickname" placeholder="您的昵称（可选）">
                            </div>
                            <div class="mb-2">
                                <textarea class="blog-form-control" name="content" rows="2" placeholder="请输入回复内容" required></textarea>
                            </div>
                            <button type="submit" class="blog-btn blog-btn-secondary">提交回复</button>
                        </form>
                    </div>
                    
                    <!-- 回复列表 -->
                    <div class="replies-list" style="margin-top: 1rem; padding-left: 2rem; border-left: 2px solid #eee;">
                        <div class="reply-item" th:each="reply : ${comment.replies}" style="padding: 0.5rem 0; border-bottom: 1px dashed #eee;">
                            <div class="reply-header" style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <div class="reply-author" style="font-weight: 500;">
                                    <span th:text="${reply.nickname != null and !reply.nickname.isEmpty() ? reply.nickname : '匿名用户'}">匿名用户</span>
                                </div>
                                <div class="reply-date" style="color: #999; font-size: 0.8rem;" th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm')}">
                                    2025-10-17 12:00
                                </div>
                            </div>
                            <div class="reply-content" th:text="${reply.content}">
                                回复内容
                            </div>
                            
                            <!-- 回复的回复 -->
                            <div th:if="${!#lists.isEmpty(reply.replies)}" th:each="replyOfReply : ${reply.replies}" style="margin-top: 0.5rem; padding: 0.5rem; background-color: #f0f0f0; border-radius: 3px;">
                                <div class="reply-header" style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                    <div class="reply-author" style="font-weight: 500;">
                                        <span th:text="${replyOfReply.nickname != null and !replyOfReply.nickname.isEmpty() ? replyOfReply.nickname : '匿名用户'}">匿名用户</span>
                                    </div>
                                    <div class="reply-date" style="color: #999; font-size: 0.8rem;" th:text="${#temporals.format(replyOfReply.createdAt, 'yyyy-MM-dd HH:mm')}">
                                        2025-10-17 12:00
                                    </div>
                                </div>
                                <div class="reply-content" th:text="${replyOfReply.content}">
                                    回复内容
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div th:if="${#lists.isEmpty(comments)}" class="text-center py-3">
                    <p>暂无评论，快来抢沙发吧！</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="blog-footer">
        <div class="blog-content">
            <p>&copy; 2025 Qian's Blog. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // 添加页面加载动画
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.blog-container');
            if (container) {
                container.style.opacity = '0';
                container.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    container.style.transition = 'all 0.5s ease';
                    container.style.opacity = '1';
                    container.style.transform = 'translateY(0)';
                }, 100);
            }
        });
    </script>
</body>
</html>